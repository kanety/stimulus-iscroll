import{Controller as t}from"@hotwired/stimulus";class e extends t{run(t){var e=t.target==document||t.target==window?document.documentElement:this.element;this.scrolled(e)&&this.load()}scrolled(t){return t.scrollTop+t.clientHeight+this.marginValue>=t.scrollHeight}load(){var t=this.pagingTarget.querySelector(this.nextLinkValue||this.constructor.nextLink);t&&(this.nextHref=t.getAttribute("href"),this.nextHref&&(this.loading||(this.start(),fetch(this.nextHref).then(t=>{if(t.ok)return t.text();throw new Error(t.status+" "+t.statusText)}).then(t=>{this.done(t)}).catch(t=>{this.fail(t)}).then(()=>{this.end()}))))}start(){this.loading=!0,this.hasLoadingTarget&&(this.loadingTarget.style.display=""),this.dispatch("start",{detail:{href:this.nextHref}})}end(){this.loading=!1,this.hasLoadingTarget&&(this.loadingTarget.style.display="none"),this.dispatch("end",{detail:{href:this.nextHref}})}done(t){var e=(new DOMParser).parseFromString(t,"text/html"),i=e.querySelector("[data-"+this.identifier+'-target="content"]'),n=e.querySelector("[data-"+this.identifier+'-target="paging"]');this.contentTarget.insertAdjacentHTML("beforeend",i.innerHTML),this.pagingTarget.innerHTML=n.innerHTML,this.dispatch("done",{detail:{href:this.nextHref,content:i,paging:n,html:t}})}fail(t){this.dispatch("fail",{detail:{href:this.nextHref,error:t}})}}e.targets=["content","paging","loading"],e.values={nextLink:String,margin:{type:Number,default:5}},e.nextLink="a.next";export{e as default};
//# sourceMappingURL=index.module.js.map
