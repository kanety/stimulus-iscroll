{"version":3,"file":"index.modern.js","sources":["../src/index.js"],"sourcesContent":["import { Controller } from '@hotwired/stimulus';\n\nexport default class extends Controller {\n  static targets = ['content', 'paging', 'loading'];\n  static values = {\n    nextLink: String,\n    margin: { type: Number, default: 5 }\n  };\n\n  static nextLink = 'a.next';\n\n  run(e) {\n    let target = e.target == document || e.target == window ? document.documentElement : this.element\n    if (this.scrolled(target)) this.load();\n  }\n\n  scrolled(element) {\n    let scrollTop = element.scrollTop;\n    let scrollHeight = element.scrollHeight;\n    let contentHeight = element.clientHeight;\n    return scrollTop + contentHeight + this.marginValue >= scrollHeight;\n  }\n\n  load() {\n    let link = this.pagingTarget.querySelector(this.nextLinkValue || this.constructor.nextLink);\n    if (!link) return;\n\n    this.nextHref = link.getAttribute('href');\n    if (!this.nextHref) return;\n\n    if (this.loading) return;\n\n    this.start();\n    fetch(this.nextHref).then(response => {\n      if (response.ok) {\n        return response.text();\n      } else {\n        throw new Error(`${response.status} ${response.statusText}`);\n      }\n    }).then(html => {\n      this.done(html);\n    }).catch(error => {\n      this.fail(error);\n    }).then(() => {\n      this.end();\n    });\n  }\n\n  start() {\n    this.loading = true;\n    if (this.hasLoadingTarget) {\n      this.loadingTarget.style.display = '';\n    }\n    this.dispatch('start', { detail: { href: this.nextHref } });\n  }\n\n  end() {\n    this.loading = false;\n    if (this.hasLoadingTarget) {\n      this.loadingTarget.style.display = 'none';\n    }\n    this.dispatch('end', { detail: { href: this.nextHref } });\n  }\n\n  done(html) {\n    const parser = new DOMParser();\n    const doc = parser.parseFromString(html, 'text/html');\n\n    let content = doc.querySelector(`[data-${this.identifier}-target=\"content\"]`);\n    let paging = doc.querySelector(`[data-${this.identifier}-target=\"paging\"]`);\n\n    this.contentTarget.insertAdjacentHTML('beforeend', content.innerHTML);\n    this.pagingTarget.innerHTML = paging.innerHTML;\n\n    this.dispatch('done', { detail: { href: this.nextHref, content: content, paging: paging, html: html } });\n  }\n\n  fail(error) {\n    this.dispatch('fail', { detail: { href: this.nextHref, error: error } });\n  }\n}\n"],"names":["Controller","run","e","target","document","window","documentElement","this","element","scrolled","load","scrollTop","clientHeight","marginValue","scrollHeight","link","pagingTarget","querySelector","nextLinkValue","constructor","nextLink","nextHref","getAttribute","loading","start","fetch","then","response","ok","text","Error","status","statusText","html","done","catch","error","fail","end","hasLoadingTarget","loadingTarget","style","display","dispatch","detail","href","doc","DOMParser","parseFromString","content","identifier","paging","contentTarget","insertAdjacentHTML","innerHTML","targets","values","String","margin","type","Number","default"],"mappings":"gEAE6BA,EAS3BC,IAAIC,GACF,IAAIC,EAASD,EAAEC,QAAUC,UAAYF,EAAEC,QAAUE,OAASD,SAASE,gBAAkBC,KAAKC,QACtFD,KAAKE,SAASN,IAASI,KAAKG,OAGlCD,SAASD,GAIP,OAHgBA,EAAQG,UAEJH,EAAQI,aACOL,KAAKM,aAFrBL,EAAQM,aAK7BJ,OACE,IAAIK,EAAOR,KAAKS,aAAaC,cAAcV,KAAKW,eAAiBX,KAAKY,YAAYC,UAC7EL,IAELR,KAAKc,SAAWN,EAAKO,aAAa,QAC7Bf,KAAKc,WAENd,KAAKgB,UAEThB,KAAKiB,QACLC,MAAMlB,KAAKc,UAAUK,KAAKC,IACxB,GAAIA,EAASC,GACX,OAAOD,EAASE,OAEhB,UAAUC,MAAO,GAAEH,EAASI,UAAUJ,EAASK,gBAEhDN,KAAKO,IACN1B,KAAK2B,KAAKD,KACTE,MAAMC,IACP7B,KAAK8B,KAAKD,KACTV,KAAK,KACNnB,KAAK+B,WAITd,QACEjB,KAAKgB,SAAU,EACXhB,KAAKgC,mBACPhC,KAAKiC,cAAcC,MAAMC,QAAU,IAErCnC,KAAKoC,SAAS,QAAS,CAAEC,OAAQ,CAAEC,KAAMtC,KAAKc,YAGhDiB,MACE/B,KAAKgB,SAAU,EACXhB,KAAKgC,mBACPhC,KAAKiC,cAAcC,MAAMC,QAAU,QAErCnC,KAAKoC,SAAS,MAAO,CAAEC,OAAQ,CAAEC,KAAMtC,KAAKc,YAG9Ca,KAAKD,GACH,MACMa,GADS,IAAIC,WACAC,gBAAgBf,EAAM,aAEzC,IAAIgB,EAAUH,EAAI7B,cAAe,SAAQV,KAAK2C,gCAC1CC,EAASL,EAAI7B,cAAe,SAAQV,KAAK2C,+BAE7C3C,KAAK6C,cAAcC,mBAAmB,YAAaJ,EAAQK,WAC3D/C,KAAKS,aAAasC,UAAYH,EAAOG,UAErC/C,KAAKoC,SAAS,OAAQ,CAAEC,OAAQ,CAAEC,KAAMtC,KAAKc,SAAU4B,QAASA,EAASE,OAAQA,EAAQlB,KAAMA,KAGjGI,KAAKD,GACH7B,KAAKoC,SAAS,OAAQ,CAAEC,OAAQ,CAAEC,KAAMtC,KAAKc,SAAUe,MAAOA,QA3EzDmB,QAAU,CAAC,UAAW,SAAU,aAChCC,OAAS,CACdpC,SAAUqC,OACVC,OAAQ,CAAEC,KAAMC,OAAQC,QAAS,MAG5BzC,SAAW"}